## **V6.0i.2 - Gate Adaptativo AND/OR con Tolerancia (05-nov-2024)**

### **ðŸ“Œ PROBLEMA:**

**RaÃ­z:** V6.0i usaba gate **OR** en ambos regÃ­menes â†’ rechazaba si superaba puntos **O** ATR.
En HighVol (ATR60 ~17-20) causaba rechazo masivo: 5 operaciones vs 100+ esperadas.

**Evidencia:**
```
Fecha       Rechazos    
2025-10-28       172        
2025-10-29       142        
2025-11-04       216        
```

### **ðŸŽ¯ SOLUCIÃ“N:**

**Gate adaptativo + tolerancia 5%:**
- **HighVol:** Gate AND (rechaza si supera puntos **Y** ATR)
- **Normal:** Gate OR (mantiene protecciÃ³n estricta)
- **Tolerancia:** Acepta si excede <5% del lÃ­mite

**Ejemplo:**
```
SL=65pts, 7.5ATR (lÃ­mites 60pts/7ATR + tolerancia 5%)
- Antes (OR): 65>60 â†’ RECHAZADO
- Ahora (AND + tol): 65>63 (OK) Y 7.5>7.35 (OK) â†’ ACEPTADO [NEAR_LIMIT]
```

### **ðŸ“ CAMBIOS:**

**EngineConfig.cs (lÃ­nea 1012):**
```csharp
public double ValidationTolerancePercent { get; set; } = 0.05;
```

**RiskCalculator.cs (lÃ­neas 388-455):**
```csharp
// Gate adaptativo
bool isHighVol = (regime == "HighVol");
bool slExPts = slDistancePoints > (maxSLPoints * 1.05);
bool slExATR = slDistanceATR > (maxSLATR * 1.05);
bool rejectSL = isHighVol ? (slExATR && slExPts) : (slExATR || slExPts);

if (rejectSL) { RECHAZAR }
else if (slExPts || slExATR) { LOG [NEAR_LIMIT] + ACEPTAR }
```

**ELIMINADO:** ValidaciÃ³n redundante SL en ATR (lÃ­neas 465-498)

### **ðŸ“Š EXPECTATIVAS:**

| MÃ©trica | V6.0i | V6.0i.2 |
|---------|-------|---------|
| Ops oct-nov | 5 | ~80-100 |
| Ops totales | ~105 | ~180-220 |
| R:R promedio | 0.70 | >1.0 |
| Rechazos/dÃ­a | ~150 | <20 |

### **âœ… VALIDACIÃ“N:**

- [ ] Logs "Gate=AND" en HighVol
- [ ] Logs NEAR_LIMIT presentes
- [ ] SL_CHECK_FAIL reduce ~87%
- [ ] Operaciones >180
- [ ] R:R >1.0



